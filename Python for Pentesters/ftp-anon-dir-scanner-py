#!/usr/bin/env python

import threading
import Queue
from ftplib import FTP

ftpHostList = [ 'ftp.x.org', 'ftp4.FreeBSD.org', 'ftp.ncsa.uiuc.edu', 'ftp.mozilla.org', 'ftp.crans.org' ]

class FTPScannerThread(threading.Thread):
    
    def __init__(self, tasksQueue):
        
        threading.Thread.__init__(self)
        self.tasksQueue = tasksQueue

    def run(self):
        
        while True:
            ftpHost = self.tasksQueue.get()
            
            print "Connecting to "+ ftpHost
            
            ftp = FTP(ftpHost)
            
            print ftp.login()
            
            for i in ftp.retrlines('LIST'):
                print i
            
            print ftp.quit()
            
            self.tasksQueue.task_done()


tasksQueue = Queue.Queue()

threads = []

for i in range(5):
    print "Creating ftpScanner : %d"%i
    ftpScanner = FTPScannerThread(tasksQueue)
    ftpScanner.setDaemon(True)
    ftpScanner.start()
    threads.append(ftpScanner)
    print "ftpScanner %d Created!"%i


for j in ftpHostList:
    tasksQueue.put(j)

tasksQueue.join()

#waits for all threads to exit
for item in thread:
    item.join()

print "Scanning complete!"
