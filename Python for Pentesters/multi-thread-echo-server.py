#!/usr/bin/env python

import sys
import thread
import socket
from signal import SIGINT, signal

def sig_handler(signal_number, interrupted_stack_frame):
        print "\nSIGINT received..Bye Bye"
        sys.exit(0)

def myEcho(clientSock, clientIP ):
        print "Echoing back to "+clientIP+" .."
        data = "tmp"
        while len(data):
                data = clientSock.recv(1024)
                print  data
                clientSock.send(data)
        clientSock.close()
        return

signal(SIGINT, sig_handler)

tcpSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

tcpSocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR,1)

if(len(sys.argv) < 2):
        port = 1337
else:
        port = int(sys.argv[1])

tcpSocket.bind(('', port))

tcpSocket.listen(5)

while True:
        clientSock, (clientIP, sock) = tcpSocket.accept()
        thread.start_new_thread(myEcho, (clientSock, clientIP))

