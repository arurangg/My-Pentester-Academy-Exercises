#!/usr/bin/env python

from multiprocessing import Process, Queue
from scapy.all import IP, TCP, sr1
import sys
import os
import Queue as TQ


def SynScannerProcess(target, scansQueue) :

		while True :
			try :
				port = scansQueue.get(block=False)
			except 	TQ.Empty :
				exit(0)

			ans = sr1( IP(dst=target)/TCP(dport=port, flags=2), verbose = False, timeout=.2)
			if(ans and ans[TCP].flags == 18):
				print "%d open"%port


if len(sys.argv) < 2:
	print sys.argv[0] + " <target>"
	sys.exit(1)

if os.geteuid() != 0:
	print "You don't have privileges to run this script"
	sys.exit(1)

target = sys.argv[1]
numPorts = 1000
numScannersProcesses = 10

scansQueue = Queue()
for port in range (1,numPorts+1):
	scansQueue.put(port)

for i in range(numScannersProcesses):
	procScanner = Process(target=SynScannerProcess, args=(target,scansQueue))
	procScanner.start()
