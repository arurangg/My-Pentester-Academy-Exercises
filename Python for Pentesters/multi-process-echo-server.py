#!/usr/bin/env python

import sys
import socket
from multiprocessing import Process
from signal import SIGINT, signal

def clientHandler(clientSocket, clientIP):
	print "Echoing back to "+clientIP+" ..."
	data = "tmp"
	while len(data):
		data = clientSocket.recv(1024)
		print data
		clientSocket.send(data)
	return

def sig_handler(signal_number, interrupted_stack_frame):
        print "\nSIGINT received..Bye Bye"
	sys.exit(0)

signal(SIGINT, sig_handler)

tcpSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
tcpSocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR,1)

if len(sys.argv) < 2:
	port = 1337
else:
	port = int(sys.argv[1])

tcpSocket.bind(('', port))

tcpSocket.listen(10)

while True:
	clientSocket, (clientIP, sock) = tcpSocket.accept()
	cHandler = Process(target=clientHandler, args=(clientSocket,clientIP))
	cHandler.start()

